<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>UBC Library Research Commons workshops</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      max-width: 800px;
      margin: auto;
    }
    h1 {
      font-size: 1.8rem;
      color: #003366;
    }
    h2 {
      margin-top: 2rem;
      font-size: 1.4rem;
      color: #0055aa;
    }
    ul {
      list-style: none;
      padding-left: 0;
    }
    li {
      margin-bottom: 1rem;
    }
    a {
      color: #0055aa;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1>UBC Library Research Commons workshops</h1>
  <div id="repo-sections"></div>

  <script>
    const TOPICS = ['data', 'geospatial', 'digital-scholarship'];

    async function loadRepos() {
      const response = await fetch('https://api.github.com/orgs/ubc-library-rc/repos?per_page=100');
      const repos = await response.json();

      // Fetch topics for each repo
      const enrichedRepos = await Promise.all(repos.map(async repo => {
        const topicRes = await fetch(repo.url + '/topics', {
          headers: { Accept: 'application/vnd.github.mercy-preview+json' }  // Required for topics
        });
        const topicData = await topicRes.json();
        return { ...repo, topics: topicData.names || [] };
      }));

      // Group by topic
      const grouped = {};
      for (const topic of TOPICS) {
        grouped[topic] = enrichedRepos.filter(repo =>
          repo.description &&
          repo.topics.includes(topic)
        );
      }

      // Render
      const container = document.getElementById('repo-sections');
      for (const topic of TOPICS) {
        const repos = grouped[topic];
        if (repos.length === 0) continue;

        const section = document.createElement('section');

        const heading = document.createElement('h2');
        heading.textContent = topic;
        section.appendChild(heading);

        const list = document.createElement('ul');
        for (const repo of repos) {
          const item = document.createElement('li');
          const link = document.createElement('a');
          link.href = repo.html_url;
          link.textContent = repo.description;
          link.target = '_blank';
          link.rel = 'noopener noreferrer';
          item.appendChild(link);
          list.appendChild(item);
        }

        section.appendChild(list);
        container.appendChild(section);
      }
    }

    loadRepos();
  </script>
</body>
</html>
